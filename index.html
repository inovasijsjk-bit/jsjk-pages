<!doctype html>
<html lang="ms">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CCID ScamBOT</title>
</head>
<body>

  <!-- ... UI anda (chat, input, button) ... -->
  <div id="chat"></div>

  <input id="msg" placeholder="Taip mesej..." />
  <button id="send">Send</button>
  <button id="quickCheck">Quick Check</button>

  <div>Status: <span id="status">-</span></div>
  <div>API: <span id="apibase"></span></div>
  <div id="hint"></div>

  <!-- ✅ Pastikan semua JS dalam satu <script> ini -->
  <script>
    const API_BASE = "https://ccid-scambot-api.ccid-scambot.workers.dev";
    document.getElementById("apibase").textContent = API_BASE;

    const chatEl = document.getElementById("chat");
    const statusEl = document.getElementById("status");
    const hintEl = document.getElementById("hint");

    function addMsg(text, who, meta = "") {
      const wrap = document.createElement("div");
      wrap.className = "msg " + who;
      wrap.textContent = text;

      if (meta) {
        const m = document.createElement("div");
        m.className = "meta";
        m.textContent = meta;
        wrap.appendChild(m);
      }
      chatEl.appendChild(wrap);
    }

    async function healthCheck() {
      try {
        const res = await fetch(API_BASE + "/");
        const data = await res.json();
        statusEl.textContent = data.ok ? "OK ✅" : "Not OK ❌";
      } catch (e) {
        statusEl.textContent = "Failed ❌";
      }
    }

    async function sendChat(message) {
      addMsg(message, "user");
      try {
        const res = await fetch(API_BASE + "/api/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message }),
        });
        const data = await res.json();
        addMsg(data.reply?.message || "(tiada jawapan)", "bot");
      } catch (e) {
        addMsg("Ralat: gagal sambung API.", "bot");
      }
    }

    document.getElementById("send").addEventListener("click", () => {
      const input = document.getElementById("msg");
      const text = input.value.trim();
      if (!text) return;
      input.value = "";
      sendChat(text);
    });

    document.getElementById("msg").addEventListener("keydown", (e) => {
      if (e.key === "Enter") document.getElementById("send").click();
    });

    // init
    healthCheck();
    addMsg("Hai! Saya CCID ScamBOT. Taip situasi anda atau nombor untuk semakan (contoh: Tolong semak 012-3456789).", "bot");
  </script>

</body>
</html>
